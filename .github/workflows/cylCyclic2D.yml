name: cylCyclic2D
on:
  push:
    paths:
      - '.github/workflows/cylCyclic2D.yml'
      - 'solvers/**'
      - 'tutorials/*Foam/cylCyclic2D/**'
  pull_request:
    branches:
      - master

jobs:
  openfoam8:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: apt-get
      run: |
        sudo sh -c "wget -O - http://dl.openfoam.org/gpg.key | apt-key add -"
        sudo add-apt-repository http://dl.openfoam.org/ubuntu
        sudo apt update
        sudo apt install -y openfoam8
    - name: pip3
      run: pip3 install -r requirements.txt
      working-directory: src/foam2py

    - name: Allwmake
      run: . /opt/openfoam8/etc/bashrc && solvers/./Allwmake
    - name: Allrun
      run: |
        for CASE_PATH in *Foam/cylCyclic2D; do
          if test -d "$CASE_PATH"; then
            . /opt/openfoam8/etc/bashrc && $CASE_PATH/./Allrun
          fi
        done
      working-directory: tutorials
    - name: post_process.py
      run: ./post_process.py
      working-directory: tutorials/multiCompressionFoam/cylCyclic2D

    - uses: actions/upload-artifact@v2
      if: always()
      with:
        name: artifacts-cylCyclic2D
        path: |
          tutorials/*Foam/cylCyclic2D/log.*Mesh
          tutorials/*Foam/cylCyclic2D/log.*Foam
          tutorials/*Foam/cylCyclic2D/log.post*